> 2024年5月20日10:35:04
> 
> author : binghong Pan, 

<hr>

<h1> 开发计算大语言模型中显存计算工具</h1>

<h2>1. 大模型参数计算公式</h2>

| n-layer | 模型层数         |     |
| ------- | ------------ | --- |
| d-model | 模型残差输出维度大小   |     |
| d-ff    | 前馈神经网络输出维度大小 |     |
| d-attn  | 注意力网络输出维度大小  |     |
| n-heads | 每一层的多头注意力的数量 |     |
| n-ctx   | 输入的上下文长度大小   |     |

<h2>2. 显存占用量计算公式</h2>

- 模型参数存储
  
  - 模型参数量 : 1B为10亿, 例如`LLaMA 7B模型有大约7 billion（即7×10^9）个参数`
  
  - 单位参数所占存储量
  
  ```json
      data_types = [
        ("FP32", 4),  # 单精度浮点数
        ("FP16", 2),  # 半精度浮点数
        ("BF16", 2),  # Brain Floating Point
        ("FP64", 8),  # 双精度浮点数
        ("INT8", 1),  # 8位整数
        ("INT16", 2),  # 16位整数
        ("INT32", 4),  # 32位整数
        ("INT64", 8),  # 64位整数
        ("UINT8", 1),  # 8位无符号整数
        ("UINT16", 2),  # 16位无符号整数
        ("UINT32", 4),  # 32位无符号整数
        ("UINT64", 8),  # 64位无符号整数
        ("BOOL", 1)  # 布尔值
    ]
  ```
  
  - 计算公式 :
  
  - ```python
    #  模型参数存储总量 = 模型参数量 * 单位参数所占存储量
    ```

- 优化器状态

- 激活值

- 额外显存开销
